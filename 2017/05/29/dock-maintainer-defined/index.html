<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Dock-maintainer: Defined - Zack McCauley</title>
    <meta name="description" content="Hi, I’m a macadmin for a school district in Montana. I like to program things sometimes. I am always learning.
">
    <meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Dock-maintainer: Defined - Zack McCauley"><meta property="og:site_name" content="Zack McCauley"><meta property="og:description" content="Hi, I’m a macadmin for a school district in Montana. I like to program things sometimes. I am always learning."><meta property="og:url" content="https://wardsparadox.github.io/2017/05/29/dock-maintainer-defined/"><meta property="article:published_time" content="2017-05-29T16:00:00-06:00"><meta property="article:author" content="https://wardsparadox.github.io/about">

    

    
    <meta name="google-site-verification" content="99065592" />
    

    <link rel="alternate" type="application/rss+xml" href="https://wardsparadox.github.io/feed.xml">
    <link rel="shortcut icon" href="https://wardsparadox.github.io/favicon.ico">
    <link rel="prefetch" href="https://wardsparadox.github.io">
    <link rel="canonical" href="https://wardsparadox.github.io/2017/05/29/dock-maintainer-defined/">
    <link rel="stylesheet"
    href="https://wardsparadox.github.io/assets/css/main.css">
    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="57x57" href="https://wardsparadox.github.io/assets/images/favicons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://wardsparadox.github.io/assets/images/favicons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://wardsparadox.github.io/assets/images/favicons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://wardsparadox.github.io/assets/images/favicons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114"  href="https://wardsparadox.github.io/assets/images/favicons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120"  href="https://wardsparadox.github.io/assets/images/favicons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144"  href="https://wardsparadox.github.io/assets/images/favicons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152"  href="https://wardsparadox.github.io/assets/images/favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180"  href="https://wardsparadox.github.io/assets/images/favicons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="https://wardsparadox.github.io/assets/images/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://wardsparadox.github.io/assets/images/favicons/android-chrome-192x192.png"  sizes="192x192">
    <link rel="icon" type="image/png" href="https://wardsparadox.github.io/assets/images/favicons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="https://wardsparadox.github.io/assets/images/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="https://wardsparadox.github.io/assets/images/favicons/manifest.json">
    <link rel="mask-icon" href="https://wardsparadox.github.io/assets/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#fffff">
    <meta name="msapplication-TileImage" content="https://wardsparadox.github.io/assets/images/favicons/mstile-144x144.png">
    <meta name="themesettings-color" content="#ffffff">
    <!-- /Favicons -->

    <!-- IE Fixes -->
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
<link href="//netdna.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.css" rel="stylesheet">
    <style type="text/css">a,.post-title a{color:#2192BB}a:hover{border-bottom-color:#2192BB}.sidebar{background-color:#2192BB}.wc-top,.sidebar-toggle:active,#sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#2192BB}.sidebar a:hover,.sidebar .sidebar-nav a{border-bottom-color:#25a3d1}.sidebar .sidebar-nav{border-top-color:#25a3d1}.sidebar .sidebar-nav a.sidebar-nav-item:hover,.sidebar .sidebar-nav a.sidebar-nav-item:focus{background:#239cc8}.sidebar .sidebar-nav .sidebar-nav-item.active{background-color:#1f88ae}ul.social-media li>a{background-color:#1f88ae;border-color:#25a3d1;border-bottom-color:#25a3d1 !important}ul.social-media li>a:hover{background-color:#e1f3fa}.btn{border-color:#2192BB;background:#2192bb}.btn:hover,.btn:focus{border-color:#1d81a5;background:#1d81a5}</style>
  </head>
  <body>
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><div class="sidebar" id="sidebar">    <img    src="https://wardsparadox.github.io/assets/images/avatar.jpg"    alt="Zack McCauley" />    <div class="sidebar-info">      <p>        Hi, I’m a macadmin for a school district in Montana. I like to program things sometimes. I am always learning.      </p>  </div>  <nav class="sidebar-nav">    <a class="sidebar-nav-item"      href="https://wardsparadox.github.io/">      Home    </a>                <a class="sidebar-nav-item "      href="https://wardsparadox.github.io/about">      About me    </a>                <a class="sidebar-nav-item "      href="https://wardsparadox.github.io/archive">      Blog Archive    </a>                <a class="sidebar-nav-item "      href="https://wardsparadox.github.io/tags">      Tags    </a>      </nav>  <div class="sidebar-info small">     <p>       Made by <a href="https://github.com/gayanvirajith/gaya" target="_blank">Gayan Virajith</a> For everyone.       Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>     </p>  </div>  <ul class="social-media">        <li>        <a title="mccauley_zack on Twitter"            href="https://twitter.com/mccauley_zack"            class="twitter wc-img-replace" target="_blank">Twitter</a>    </li>            <li>        <a title="108452882684071984253 on Google Plus"            href="https://plus.google.com/108452882684071984253"            class="google wc-img-replace" target="_blank">Google</a>    </li>                <li>        <a title="wardsparadox on Github"            href="https://github.com/wardsparadox"            class="github wc-img-replace" target="_blank">Github</a>    </li>                    <li>        <a title="zack_mccauley @ macadmins.org on Slack"            href="https://www.macadmins.org/"            class="slack wc-img-replace" target="_blank">Slack</a>    </li>        <li>        <a title="Subscribe via RSS"            href="https://wardsparadox.github.io/feed.xml"            class="rss wc-img-replace" target="_blank">            RSS        </a>    </li></ul></div>

    <div class="main-wrapper">
      <div class="header">
        <div class="container">
          <div class="header-logo"><a href="https://wardsparadox.github.io/"   title="Zack McCauley">  <img     src="https://wardsparadox.github.io/assets/images/logo.jpg"    alt="Zack McCauley" /></a></div>
          <div class="header-title">
            <a href="https://wardsparadox.github.io/"
              title="Zack McCauley">
              <h3>Zack McCauley<small>Fixer of Machines, Breaker of Code</small></h3>
            </a>
          </div>
        </div>
      </div>

      <div class="container content">
          <div class="post">

  

  

  <header class="post-header">
    <h1 class="post-title">Dock-maintainer: Defined</h1>
    <p class="post-meta">
    
      <span class="categories">
      dock-maintainer, python
      </span> |
    
    <span class="post-date">
    May 29, 2017
    </span>
    </p>
  </header>

  <article class="post-content">
    <p>Recently I created a tool called dock-maintainer. This post goes over a couple things but mainly serves to explain why I created it and why I needed it instead of using other solutions. Traditionally this job (maintaining Dock configurations) has been handled in a multitude of ways. There have been many ways to do this. One can use configuration profiles, puppet/salt/chef/etc, <code class="highlighter-rouge">outset</code> with a script (a method I used until recently).
<!--more--></p>

<p>I found a few problems with the previous methods. With configuration profiles, I could not find a reliable way to deploy a Dock payload for a specified user. If you installed it via <a href="https://www.munki.org/">munki</a>, this forced it for all users. I forked and changed Nick McSpadden’s tool, <a href="https://github.com/nmcspadden/outsetDockProfiler">Outset Dock Profiler</a>. This packaged the profile and created a script to load it via <code class="highlighter-rouge">outset</code> at login. The rewrite allowed for multiple profiles to be loaded via <code class="highlighter-rouge">outset</code> per user. This created another issue; upon login due to parental controls being loaded, it would prompt for a password to allow managed preferences changes. There was also issues that it created a singular install script that could affect other things in edge cases. This was purely due to my fork and the script part not being correctly modified to handle multiple profiles.</p>

<p>I have never used puppet, chef or anything like them, so that method was out due to lack of experience and time to learn it. From what had been explained and what I had found online out of the box didn’t allow the dock customization per user that I needed either. I eventually settled on using <a href="https://github.com/chilcote/outset"><code class="highlighter-rouge">outset</code></a> to deploy an initial Dock setup script using <code class="highlighter-rouge">[dockutil](https://github.com/kcrawford/dockutil)</code>. This included a shortcut in the Dock to the <code class="highlighter-rouge">/Applications</code> folder for ease of use. I thought that this may be enough for most needs.</p>

<p>Due to our district using parental controls (soon to be changing, more on that soon), Chrome V58 stopped working with accounts using parental controls again. It would not launch correctly, if at all. I had many teachers come to me asking if I could add Firefox to the Docks on the student labs. I informed them to use Spotlight or the Applications folder shortcut already on the Dock. They stated it was difficult for the K-3 students to use those two and that it would really help to have it on the Dock. I lock the dock (our students being notorious for removing icons) using several managed preferences I found during my research into using Configuration profiles. This made it difficult for staff to add icons to dock without knowing how to use <code class="highlighter-rouge">dockutil</code> via terminal. What is nice is that the managed preferences don’t prevent <code class="highlighter-rouge">dockutil</code> from editing the <code class="highlighter-rouge">plist</code> as needed.</p>

<p>As I had already deployed <code class="highlighter-rouge">dockutil</code> to all the machines district wide, I knew that I needed to find a solution that to wrap <code class="highlighter-rouge">dockutil</code> and make it easier to setup and adjust docks without having to run a script on each machine for each change using ARD. This made me consider writing a tool to do this for me. I saw <a href="https://github.com/ygini/DockServiceManager">ygini</a> had created a wrapper for MDMs and <code class="highlighter-rouge">dockutil</code> but that wasn’t in the same way I wanted. I settled and wrote dock-maintainer which allowed me to specify an account whose dock I wanted to modify, and host the files on a simple web server. It uses <code class="highlighter-rouge">outset</code> to handle the updater and script to maintain the dock, and uses <code class="highlighter-rouge">dockutil</code> to modify the dock itself. It also auto downloads the file based on the “Last Modified” header (huge tip from @elios on the <a href="http://macadmins.org">macadmins</a> slack for recommending this!), so only if it needs to by storing those dates in extended attributes of the file. If it detects any changes, it clears the entire dock to ensure a clean run of adding all the items back in. It also exits cleanly if it detects no changes and doesn’t mess the dock.</p>

<p>To take advantage of this tool, you will need to have a web server, a text editor, and have the short name of the account you wish to manage handy. I would recommend using a <code class="highlighter-rouge">munki</code> repo if you already have one as it is setup in the same fashion. I created a folder in my <code class="highlighter-rouge">munki</code> repo called <code class="highlighter-rouge">docksetups</code>. In this I created a <code class="highlighter-rouge">plist</code> for every user that I wish to manage (remember it’s the short name that is returned not the users full name), with no file extension. In each <code class="highlighter-rouge">plist</code> there must be two arrays, one called Apps and one called Others. In each array use string elements with the full path to the item you want in the dock. In the Others array you can use ~ to reference items in the HOME directory of that user. You will then need to set the preferences up on the machines you wish to manage. The domain is <code class="highlighter-rouge">com.github.wardsparadox.dock-maintainer</code>. There are two keys, <code class="highlighter-rouge">ManagedUser</code> and <code class="highlighter-rouge">ServerURL</code>. The <code class="highlighter-rouge">ManagedUser</code> key must be the same as the name of <code class="highlighter-rouge">plist</code> and the the short name as the user you wish to manage. The server URL key is the path to the server folder you setup i.e.: <code class="highlighter-rouge">http://munki.example.com/munki_repo/docksetups</code>.</p>

<p>I plan to add more logging features in the future. I hope this article makes the creation of yet another tool more understood.</p>

  </article>

  
    <div class="related-posts">
      <h4>Related Posts</h4>
      <ul>
        
          <li>
            <h5>
              <a href="https://wardsparadox.github.io/2018/10/16/google-packages-and-munki/">
                Google Packages and Munki
                <small>16 Oct 2018</small>
              </a>
            </h5>
          </li>
        
          <li>
            <h5>
              <a href="https://wardsparadox.github.io/2018/09/20/force-a-dep-sync-from-your-phone/">
                Force a DEP sync..from your phone!
                <small>20 Sep 2018</small>
              </a>
            </h5>
          </li>
        
          <li>
            <h5>
              <a href="https://wardsparadox.github.io/2018/04/04/modifying-safaris-autoplay-preferences/">
                Modifying Safari's Auto-Play Preferences
                <small>04 Apr 2018</small>
              </a>
            </h5>
          </li>
        
      </ul>
    </div>
  

  <div class="author-info">
    
      <div class="author">   <a href="https://wardsparadox.github.io/about">    <img      src="https://wardsparadox.github.io/assets/images/avatar.jpg"      alt="Zack McCauley" width="60" height="60" />  </a>    <h5>Author</h4>  <h6>    <a href="https://wardsparadox.github.io/about">      Zack McCauley    </a>  </h5>  <p>    Find me on            <a title="wardsparadox on GitHub"            href="https://github.com/wardsparadox"            class="github" target="_blank">Github</a>                /        <a title="zack_mccauley @ macadmins.org on slack"            href="https://macadmins.org/"            class="slack" target="_blank">Slack</a>                /        <a title="108452882684071984253 on Google Plus"            href="https://plus.google.com/108452882684071984253"            class="google" target="_blank">Google</a>      </p></div>

    

    
      <div class="share-buttons">  <h5>Share this post on</h5>  <ul class="social-media">    <li>        <a title="mccauley_zack on Twitter"           href="https://twitter.com/intent/tweet?original_referer=https://wardsparadox.github.io/2017/05/29/dock-maintainer-defined/&amp;text=Dock-maintainer: Defined&amp;url=https://wardsparadox.github.io/2017/05/29/dock-maintainer-defined/" class="twitter wc-img-replace" target="_blank">          Twitter        </a>    </li>       <li>        <a title="108452882684071984253 on Google Plus"             href="https://plus.google.com/share?url=https://wardsparadox.github.io/2017/05/29/dock-maintainer-defined/"             class="google wc-img-replace" target="_blank">Google</a>    </li>    <li>        <a title=" on Facebook"             href="https://www.facebook.com/sharer/sharer.php?u=https://wardsparadox.github.io/2017/05/29/dock-maintainer-defined/&amp;t=Dock-maintainer: Defined"             class="facebook wc-img-replace" target="_blank">Facebook</a>    </li>  </ul></div>
    
  </div>

  
</div>

      </div>
      <a href="#0" class="wc-top">Top</a>

    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle">
      <span></span>
    </label>

    <script type="text/javascript">
      var config = {
        "browser_warning_page": "https://wardsparadox.github.io/browser-warning/",
        "disqus_shortname": ""
      };
      /* Browser support detection */
      var browserSupport = (function(){
        var htmlElemClasses = document.querySelector('html').className.split(' ');
        for ( var i = 0; i < htmlElemClasses.length; i += 1 ){
          var className = htmlElemClasses[i];
          if ( className === 'lt-ie9' ){
            return true;
          }
        }
      }());

      if (browserSupport){
        window.location="https://wardsparadox.github.io/browser-warning/";
      }

      /* To avoid render blocking css */
      var cb = function() {
        var l = document.createElement('link'); l.rel = 'stylesheet';
        l.href = 'https://fonts.googleapis.com/css?family=PT+Sans';
        var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
      };
      var raf = requestAnimationFrame || mozRequestAnimationFrame ||
          webkitRequestAnimationFrame || msRequestAnimationFrame;
      if (raf) raf(cb);
      else window.addEventListener('load', cb);


    </script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script async type="text/javascript" src="https://wardsparadox.github.io/assets/js/gaya.min.js"></script>

    
    
<script type="text/javascript">var _gaq = _gaq || [];_gaq.push(['_setAccount', 'UA-99065592-1']);_gaq.push(['_trackPageview']);(function() {var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script>

  </body>
</html>
